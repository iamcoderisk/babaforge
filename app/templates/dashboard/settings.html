{% extends "base.html" %}

{% block title %}Settings - SendBaba{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">Settings</h1>
    
    <!-- API Keys Section -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">API Credentials</h2>
        <p class="text-gray-600 mb-6">Use these credentials to authenticate API requests</p>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    API Key
                    <span class="text-red-500">*</span>
                </label>
                <div class="flex">
                    <input type="password" id="apiKey" value="{{ org.api_key }}" readonly 
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-l-md bg-gray-50 font-mono text-sm">
                    <button onclick="toggleVisibility('apiKey')" 
                            class="px-4 py-2 bg-gray-100 border-t border-b border-gray-300 hover:bg-gray-200">
                        <i class="fas fa-eye" id="apiKey-icon"></i>
                    </button>
                    <button onclick="copyToClipboard('{{ org.api_key }}', 'apiKeyCopy')" 
                            id="apiKeyCopy"
                            class="px-4 py-2 bg-purple-600 text-white rounded-r-md hover:bg-purple-700">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <p class="mt-2 text-xs text-gray-500">Keep this secret! Use it in the X-API-Key header</p>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    API Secret
                </label>
                <div class="flex">
                    <input type="password" id="apiSecret" value="{{ org.api_secret }}" readonly 
                           class="flex-1 px-4 py-2 border border-gray-300 rounded-l-md bg-gray-50 font-mono text-sm">
                    <button onclick="toggleVisibility('apiSecret')" 
                            class="px-4 py-2 bg-gray-100 border-t border-b border-gray-300 hover:bg-gray-200">
                        <i class="fas fa-eye" id="apiSecret-icon"></i>
                    </button>
                    <button onclick="copyToClipboard('{{ org.api_secret }}', 'apiSecretCopy')" 
                            id="apiSecretCopy"
                            class="px-4 py-2 bg-purple-600 text-white rounded-r-md hover:bg-purple-700">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-yellow-800">Security Warning</h3>
                    <p class="mt-2 text-sm text-yellow-700">
                        Never share your API credentials or commit them to version control. 
                        If compromised, regenerate them immediately.
                    </p>
                </div>
            </div>
        </div>
        
        <div class="mt-4">
            <button onclick="regenerateAPIKey()" 
                    class="text-sm text-red-600 hover:text-red-700 font-medium">
                <i class="fas fa-sync-alt mr-1"></i>Regenerate API Keys
            </button>
        </div>
    </div>
    
    <!-- Account Information -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Account Information</h2>
        <dl class="grid grid-cols-1 gap-4">
            <div>
                <dt class="text-sm font-medium text-gray-500">Email</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ user.email }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Full Name</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ user.first_name }} {{ user.last_name }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Organization</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ org.name }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Organization ID</dt>
                <dd class="mt-1 text-sm text-gray-900 font-mono">{{ org.id }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Member Since</dt>
                <dd class="mt-1 text-sm text-gray-900">{{ user.created_at.strftime('%B %d, %Y') }}</dd>
            </div>
            <div>
                <dt class="text-sm font-medium text-gray-500">Account Status</dt>
                <dd class="mt-1">
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                        Active
                    </span>
                </dd>
            </div>
        </dl>
    </div>
    
    <!-- Webhook Configuration -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold mb-4">Webhook Configuration</h2>
        <p class="text-gray-600 mb-4">Receive real-time notifications for email events</p>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Webhook URL
            </label>
            <input type="url" 
                   value="{{ org.webhook_url or '' }}"
                   placeholder="https://your-app.com/webhooks/sendbaba"
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-purple-500 focus:border-transparent">
            <p class="mt-1 text-xs text-gray-500">We'll send POST requests to this URL for email events</p>
        </div>
        
        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Webhook Secret
            </label>
            <input type="password" 
                   value="{{ org.webhook_secret or '' }}" readonly
                   class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50 font-mono text-sm">
            <p class="mt-1 text-xs text-gray-500">Use this to verify webhook signatures</p>
        </div>
        
        <button class="px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">
            Save Webhook Settings
        </button>
    </div>
    
    <!-- Danger Zone -->
    <div class="bg-white rounded-lg shadow p-6 border-2 border-red-200">
        <h2 class="text-xl font-semibold text-red-600 mb-4">Danger Zone</h2>
        
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="text-sm font-medium text-gray-900">Delete Account</h3>
                    <p class="text-sm text-gray-500">Permanently delete your account and all data</p>
                </div>
                <button class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                    Delete Account
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function toggleVisibility(fieldId) {
    const field = document.getElementById(fieldId);
    const icon = document.getElementById(fieldId + '-icon');
    
    if (field.type === 'password') {
        field.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        field.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

function copyToClipboard(text, btnId) {
    navigator.clipboard.writeText(text).then(() => {
        const btn = document.getElementById(btnId);
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i>';
        btn.classList.add('bg-green-600');
        btn.classList.remove('bg-purple-600');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('bg-green-600');
            btn.classList.add('bg-purple-600');
        }, 2000);
    });
}

function regenerateAPIKey() {
    if (confirm('⚠️ WARNING: This will invalidate your current API keys. All existing integrations will stop working until you update them with the new keys.\n\nAre you sure you want to continue?')) {
        // TODO: Implement API key regeneration
        alert('API key regeneration will be implemented in the next update.');
    }
}
</script>
{% endblock %}
